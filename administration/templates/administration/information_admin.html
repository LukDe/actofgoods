{% extends 'administration/base_admin.html' %}
{% block content %}
{% load filter %}

<!-- modal for every information -->
<div id="standard-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="row">
                <div class="col-sm-9">
                    <h2>{{information.headline}}</h2>
                    <h6>from: {{ information.date }} / number of reports: {{ information.number_reports }}</h6>
                </div>
                <div class="col-sm-3">
                    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups" style="float: right">
                            <a id="standard-grey-button-light" class="btn btn-default btn-sml" type="button" href="{% url  'administration:info_delete' pk=information.pk %}" style="margin-top: 15px; margin-bottom: 15px;"><span class="glyphicon glyphicon-remove"></span> Delete</a>
                            <a id="standard-grey-button-light" class="btn btn-default btn-sml" type="button" href="{% url 'administration:informations' %}" style="margin-top: 15px; margin-bottom: 15px;"><span class="glyphicon glyphicon-chevron-left"></span> Back</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-body">
            <p>{{ information.text | linebreaksbr }}</p>
            <h5>Location:</h5>
            <div id="map-container" style="height: 450px; margin-top: 15px; margin-bottom: 20px;"></div>
            <div class="list-group">
                {% for comment in comments %}

                    <!-- list all informations -->
                    <a class="list-group-item" {% if comment.id == reported_comment.id %} id="red-list-group-item-div" {% else %} id="standard-list-group-item-div" {% endif %}>
                        <div class="row">
                            <div class="col-sm-12" data-toggle="modal" data-target=".{{ comment.id }}">
                                <p class="list-group-item-text">{{ comment|get_short_text:160 }}</p>
                            </div>
                            <div class="col-sm-11" data-toggle="modal" data-target=".{{ comment.id }}">
                                <h6><br>from: {{ comment.date }} / number of reports: {{ comment.number_reports }} </h6>
                            </div>
                            <div class="col-sm-1">
                                <button type="button" id="{{ comment.id }}" class="btn btn-default btn-sml standard-grey-button-light " href="" style="float: right; margin-top: 10px;" onclick="done_request(this)"><span class="glyphicon glyphicon-remove"></span> Delete</button>
                            </div>
                        </div>
                    </a>

                    <script>
                      function done_request(element){
                        var id = element.id;
                        console.log(id);
                        {% if reported_comment %}
                            {% if comment.id != reported_comment.id %}
                                $.post("{% url 'administration:comment_delete' %}", {id:id}, function(data){
                                    //no need for this method but if we want to get a callback this is the correct position
                                    location.href = "{% url 'administration:information_reported_comment_admin' pki=comment.inf.pk pkc=reported_comment.id %}";
                                });
                            {% else %}
                                $.post("{% url 'administration:comment_delete' %}", {id:id}, function(data){
                                    //no need for this method but if we want to get a callback this is the correct position
                                    location.href = "{% url 'administration:information_admin' pk=comment.inf.pk %}";
                                });
                            {% endif %}
                        {% else %}
                            $.post("{% url 'administration:comment_delete' %}", {id:id}, function(data){
                                //no need for this method but if we want to get a callback this is the correct position
                                location.href = "{% url 'administration:information_admin' pk=comment.inf.pk %}";
                            });
                        {% endif %}
                    }
                    </script>

                    <!-- modal for every comment -->
                    <div class="modal fade {{ comment.id }}"  role="dialog" aria-labelledby="request" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h2>Comment to: {{information.headline}}</h2>
                                    <h6>from {{ comment.date }} / number of reports: {{ comment.number_reports }}</h6>
                                </div>
                                <div class="modal-body">
                                    {% autoescape on %}
                                        <p>{{ comment.text|linebreaksbr }}</p>
                                    {% endautoescape %}
                                </div>
                                <div class="modal-footer">
                                    <button id="standard-grey-button-bold" type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <h4>There are no comments for this information.</h4>
                {% endfor %}
            </div>


        </div>

        <div class="modal-footer">
            <a id="standard-grey-button-light" class="btn btn-default btn-sml" type="button" href="{% url 'administration:informations' %}" style="float: right; margin: 15px;"><span class="glyphicon glyphicon-chevron-left"></span> Back</a>
        </div>
    </div>
</div>

<script src="http://maps.googleapis.com/maps/api/js"></script>
<script>

    var map;
    var marker;
    var myCenter=new google.maps.LatLng(51.508742,-0.120850);
    var geocoder;
    var infowindow;
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    function initialize() {
        geocoder = new google.maps.Geocoder()
        var mapProp = {
            center:myCenter,
            zoom:2,
            mapTypeId:google.maps.MapTypeId.ROADMAP,
            mapTypeControl: false,
            panControl:false,
            rotateControl:false,
            mapTypeControl:true,
            streetViewControl: false
        };
        marker=null;

        map = new google.maps.Map(document.getElementById("map-container"),mapProp);

        placeMarker(new google.maps.LatLng(parseFloat("{{ information.address.latitude }}".replace(",", ".")), parseFloat("{{ information.address.longditude }}".replace(",", "."))));
  }

  function placeMarker(location) {
      if(marker){
          infowindow.close();
          marker.setPosition(location);
          geocoder.geocode({'location': location}, function(results, status){
              infowindow.setContent(results[0].formatted_address);
              infowindow.open(map,marker);
          })
      }else{
          marker = new google.maps.Marker({
          position: location,
          map: map,
          });
          geocoder.geocode({'location': location}, function(results, status){
              infowindow = new google.maps.InfoWindow({content: results[0].formatted_address});
              infowindow.open(map,marker);
          })
          map.setZoom(8);
      }
      map.setCenter(marker.getPosition());
  }
  google.maps.event.addDomListener(window, 'load', initialize);


</script>

{% endblock %}
