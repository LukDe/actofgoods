{% extends 'basics/base.html' %}
{% block content %}
<script
src="http://maps.googleapis.com/maps/api/js">
</script>

<script>
var map;
var marker;
var myCenter=new google.maps.LatLng(51.508742,-0.120850);
var geocoder;
var infowindow;
var x = document.getElementById("lat");
var y = document.getElementById("lng");

function initialize()
{
    geocoder = new google.maps.Geocoder()
var mapProp = {
  center:myCenter,
  zoom:5,
  mapTypeId:google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

  google.maps.event.addListener(map, 'click', function(event) {
    placeMarker(event.latLng);
  });
}

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else { 
        x.innerHTML = "Geolocation is not supported";
        y.innerHTML = "by this browser.";
    }
}

function showPosition(position) {
    document.getElementById("lat").innerHTML = "Latitude: " + position.coords.latitude;
    document.getElementById("lng").innerHTML = "Longitude: " + position.coords.longitude;
    var latlng={lat: parseFloat(position.coords.latitude), lng: parseFloat(position.coords.longitude)};
    placeMarker(latlng);
}

function placeMarker(location) {
    if(marker){
        infowindow.close();
        marker.setPosition(location)
        geocoder.geocode({'location': location}, function(results, status){
            infowindow.setContent(results[1].formatted_address);
            infowindow.open(map,marker);
        })   
    } 
    else{
        marker = new google.maps.Marker({
        position: location,
        map: map,
        });
        geocoder.geocode({'location': location}, function(results, status){
            infowindow = new google.maps.InfoWindow({content: results[1].formatted_address});
            infowindow.open(map,marker);
        })
    }
    document.getElementById("lat").innerHTML = "Latitude: " + location.lat();
    document.getElementById("lng").innerHTML = "Longitude: " + location.lng();
}

$(".modal-choose-location").on("shown.bs.modal", function () {
    google.maps.event.trigger(map, "resize");
});


google.maps.event.addDomListener(window, 'load', initialize);
</script>

	<button type="button" class="btn btn-info" data-toggle="modal" data-target=".modal-choose-location">choose location</button>
		<div class="modal fade modal-choose-location"  role="dialog" aria-labelledby="choose-location" aria-hidden="true">
			<div class="modal-dialog modal-lg">  							
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h2 class="text-center">Choose your Location</h2>
					</div>
					<div class="modal-body">
				  	<!-- Introduction Row -->
				       	<div class="row">
				            <div class="col-lg-12">
				                <button onclick="getLocation()">Get My Location</button>
				                <p id="lat">Latitude: </p)<br>
				                <p id="lng">Longitude: </p)<br>
			               <div id="googleMap" style="width:500px;height:380px;"></div>
			            </div>
			        </div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
       
{% endblock %}
